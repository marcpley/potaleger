name: Compil for Linux x64
#run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [push]
jobs:
  Build:
    runs-on: ubuntu-22.04
    steps:
      - run: echo "The job was automatically triggered by a ${{ github.event_name }} event."

      - name: Qt installation dir
        id: qt-installation-dir
        run: echo "DIR=$(readlink -f ${{ github.workspace }}/..)" >> $GITHUB_OUTPUT

      - name: Install Qt
        uses: jurplel/install-qt-action@v4.1.1
        with:
            cache: false
            version: 6.8.1
            host: 'linux'
            dir: '${{ steps.qt-installation-dir.DIR }}'
            #setup-python: false
            #extra: '--external 7z'

      - name: Debug
        shell: bash
        run: |
            ls -l /home/runner/work/potaleger/Qt/6.8.1/gcc_64/lib/

      - uses: actions/checkout@v4
        with:
          repository: '${{ github.repository }}'
          ref: 'main'

      - name: Build
        shell: bash
        run: |
            mkdir build
            cd build
            qmake ../potaleger.pro "QT += svg"
            make -j 4
            ls -l

      - name: Prepare artifact
        shell: bash
        run: |
            mkdir artifact
            mkdir artifact/libs
            cp ./build/potaleger ./artifact/
            cp -P /home/runner/work/potaleger/Qt/6.8.1/gcc_64/lib/libQt6Core.so* ./artifact/libs/

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
           name: potaleger0100linux
           path: artifact
